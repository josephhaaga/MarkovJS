<html>
	<script   src="https://code.jquery.com/jquery-migrate-3.0.0.min.js"   integrity="sha256-JklDYODbg0X+8sPiKkcFURb5z7RvlNMIaE3RA2z97vw="   crossorigin="anonymous"></script>
	<body>
		<script>

			 // 88  88 888888 88     8888o. 888888 8888o.    888888 88  88 8888o. .o8888 888888 88 .o88o. 8888o. .o8888 
			 // 88  88 88     88     88  88 88     88  88    88     88  88 88  88 88       88   88 88  88 88  88 88     
			 // 888888 8888   88     8888Y' 8888   8888Y'    8888   88  88 88  88 88       88   88 88  88 88  88 'Y88o. 
			 // 88  88 88     88     88     88     88  88    88     88  88 88  88 88       88   88 88  88 88  88     88 
			 // 88  88 888888 888888 88     888888 88  88    88     'Y88Y' 88  88 'Y8888   88   88 'Y88Y' 88  88 8888Y' 

			var __VERBOSE__ = true;

			function print_for_debug(a_string){
				if(__VERBOSE__){
					console.log(a_string);
				}
			}
			function count_of(input_word){
				if(input_text.indexOf(input_word)>-1){
					return (input_text.split(input_word).length - 1);
				}
			}
			function getAllIndexes(arr, val) {
			    var indexes = [], i;
			    for(i = 0; i < arr.length; i++)
			        if (arr[i] === val)
			            indexes.push(i);
			    return indexes;
			}

			var input_text = "The quick brown fox jumped over the lazy dog. I dont know why the dog was so lazy, but the fox was the quick and brown";

			input_text = input_text.toLowerCase().replace(",","").replace(".","");


			var array_of_words = input_text.split(" ");

			print_for_debug(array_of_words);

			var uniques = [];

			for(var i=0; i<array_of_words.length; i++){
				// Clean up input text
				// array_of_words[i] = array_of_words[i].toLowerCase().replace(",","").replace(".","");
				if(!uniques.includes(array_of_words[i])){
					uniques.push(array_of_words[i]);
				}
			}

			print_for_debug("uniques "+uniques);

			// generate probabilities
			var probabilities = [];

			var individual_counts = {}


			// probability (j | i) = count(i + j) / count (i)

			for(var j=0; j<uniques.length; j++){
				individual_counts[uniques[j]] = count_of(uniques[j]);
			}

			var first_word = "";
			var second_word = "";
			var appearances = [];
			var following_words = [];
			var master_list = [];
			var temp = {};

			for(var k=0; k<uniques.length; k++){
				temp = {};
				first_word=uniques[k];
				print_for_debug(first_word);
				appearances = getAllIndexes(array_of_words,first_word);

				for(var z=0;z<appearances.length;z++){
					second_word = array_of_words[appearances[z]+1];
					print_for_debug("    "+second_word);
					temp[second_word] = (count_of(first_word+" "+second_word)/count_of(first_word));

				}

				// master_list[first_word] = temp;
				master_list.push([first_word,temp]);

			}

			function get_max_dictionary_value(dictionary){
				var key_of_largest_item = "";
				var largest_value = 0;
				for(var key in dictionary){
					if(dictionary[key]>largest_value){
						largest_value = dictionary[key];
						key_of_largest_item=key;
					}
				}
				return key_of_largest_item;
			}


			function generate(output_length){
				var master_string = uniques[Math.floor(Math.random()*uniques.length)];
				var temp_word = master_string;
				for(var q=0;q<output_length-1;q++){
					// temp_word = master_list[uniques.indexOf(temp_word)];
					// print_for_debug(master_list[uniques.indexOf(temp_word)][0]+" "+master_list[uniques.indexOf(temp_word)][1]);
					// print_for_debug(master_list[uniques.indexOf(temp_word)][1]);

					temp_word = get_max_dictionary_value(master_list[uniques.indexOf(temp_word)][1])
					master_string = master_string + " " + temp_word;
				}
				print_for_debug(master_string);
			}



		</script>
	</body>
</html>